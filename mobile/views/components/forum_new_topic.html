{style}
/*File attachments*/
.ow_file_attachment_preview {
    width: 100%;
    height: auto;
    margin-top: -2px;
    margin-bottom: 6px;
}
.ow_file_attachment_block1, .ow_file_attachment_block2 {
    float: left;
    width: 100%;
    box-sizing: border-box;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    margin: 2px 0;
}
.ow_file_attachment_block1 {
    padding-right: 4px;
}
.ow_file_attachment_block2 {
    padding-left: 4px;
}
.ow_dialog_items_wrap .ow_file_attachment_block1,
.ow_dialog_items_wrap .ow_file_attachment_block2 {
	width: auto;
	float: none;
	padding-right: 0;
	padding-left: 0;
	padding-top: 4px;
}
.ow_dialog_items_wrap .ow_file_attachment_info,
.ow_mailbox_log .ow_file_attachment_info {
	padding-right: 4px;
}
.ow_dialog_item_mailchat .ow_mailbox_message_content_attach {
    padding-top: 0px;
}
.ow_dialog_items_wrap .ow_file_attachment_name,
.ow_mailbox_log .ow_file_attachment_name {
	font-weight: normal;
	padding-right: 4px;
}
.ow_file_attachment_info {
    border: 1px solid #DCDCDC;
    border-radius: 2px;
    -moz-border-radius: 2px;
    -webkit-border-radius: 2px;
    padding-right: 50px;
    position: relative;
    height: 22px;
    overflow: hidden;
}
.ow_file_attachment_info a {
	line-height: 22px;
	padding-left: 8px;
}
.ow_dialog_in_item.fileattach {
	padding-top: 1px;
	padding-bottom: 1px;
}
.ow_dialog_in_item.fileattach .ow_file_attachment_info {
	border: none;
}
.ow_file_attachment_name {
    width: 100%;
    line-height: 22px;
    height: 22px;
    overflow: hidden;
    padding-left: 8px;
    font-size: 11px;
    font-weight: bold;
}
.ow_file_attachment_size {
    font-weight: normal;
    display: none;
}
.ow_file_attachment_close {
    position: absolute;
    top: 0;
    right: 0;
    width: 22px;
    height: 22px;
    border-left: 1px solid #DCDCDC;
    background-image: url(http://10.0.0.180/ow_static/themes/origin/images/tag_close_btn.png);
    background-repeat: no-repeat;
    background-position: center center;
    box-sizing: border-box;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
}
.ow_file_attachment_preload {
    position: absolute;
    top: 0;
    right: 25px;
    width: 16px;
    height: 22px;
    background: url(/images/ajax_preloader_content.gif) center center no-repeat;
    display: none;
}
{/style}

{style}
    #owm_forum_topic_attachments .ow_status_update_btn_block {
        display:none;
    }
{/style}

{form name="topic_form"}
    <div class="owm_forum_topic owm_forum_topic_reply">
        <div class="owm_forum_topic_nav">
            <div class="owm_forum_topic_title owm_bg_color_1">
                {input name="title"}
                {error name="title"}
            </div>
            <div class="owm_forum_name_select owm_bg_color_1">
                <div class="owm_select_wrap">
                    <div class="ow_inline owm_inline">
                        {input name="group"}
                        {error name="group"}
                    </div>
                </div>
            </div>
            <div class="owm_forum_topic_subscribe owm_bg_color_1">
                <div class="owm_checkbox_wrap">
                    <ul class="ow_checkbox_group clearfix">
                        <li>
                            {input name="subscribe"}
                            {label name="subscribe"}
                            {error name="subscribe"}
                        </li>
                    </ul>
                </div>
            </div>
            <div class="owm_forum_name_select owm_bg_color_1">
                <div class="owm_select_wrap">
                    <div class="ow_inline owm_inline">
                        {input name="text"}
                    </div>
                </div>
                {error name="text"}
            </div>
            <div class="owm_forum_topic_bottom owm_forum_topic_submit owm_padding owm_bg_color_1 clearfix">
                {if $enableAttachments}
                    <div class="owm_forum_topic_attach_info owm_float_left">
                        <label id="owm_forum_new_topic_attach_file" class="owm_attach_label owm_topic_attach_icon">
                            <span id="owm_forum_new_topic_attach_default_title">{text key='forum+attach_files'}</span>
                            <span id="owm_forum_new_topic_first_attach_name" style="display: none"></span>
                        </label>
                    </div>
                {/if}
                <div class="owm_float_right owm_forum_topic_submit">
                    <span class="ow_button">
                        {submit name="post"}
                    </span>
                </div>
            </div>
        </div>
    </div>
{/form}

{if $enableAttachments}
    <div style="display: none">
        <div id="owm_forum_topic_attachments">
            {$attachments}
            <span class="ow_button">
                <span class="ow_button">
                    <input type="button" id="owm_forum_new_topic_clear_files" value="{text key='forum+clear_all'}">
                </span>
            </span>
            <span class="ow_button">
                <span class="ow_button">
                    <input type="button" id="owm_forum_new_topic_attach_files" value="{text key='forum+add_files'}">
                </span>
            </span>
        </div>
    </div>

    {script}
        $( document ).ready(function() 
        { 
            var filesList = [];
            var attachmentUid = '{$attachmentUid}';
            var $attachDefaultTitle = $("#owm_forum_new_topic_attach_default_title");
            var $firstAttachName = $("#owm_forum_new_topic_first_attach_name");
 
            // listen to upload new files event
            OW.bind('base.attachment_rendered', function(item) 
            {
                // we should listen only our attachment instance
                if (attachmentUid != this.uid)
                {
                    return;
                }

                // remember the added file
                var file = item.data;
                filesList.push({ id: file.id, name: file.name, size: file.size });

                // show the single attached name
                if ( !$firstAttachName.text() )
                {
                    $attachDefaultTitle.hide();
                    $firstAttachName.text(getAttachedFilesName()).show();
                    return;
                }
                
                // update the attach name
                $firstAttachName.text(getAttachedFilesName());
            });
 
            // listen to delete files event
            OW.bind('base.attachment_deleted', function(data) 
            {
                // we should listen only our attachment instance
                if (attachmentUid != this.uid)
                {
                    return;
                }

                // delete the file
                filesList = filesList.filter(function (el) 
                {
                    return el.id != data.id;
                });

                // display the default attach title
                if ( !filesList.length )
                {
                    $attachDefaultTitle.show();
                    $firstAttachName.text("").hide();
                    return;
                }
 
                // update the first attach file name
                $firstAttachName.text(getAttachedFilesName()).show();
            });

            // listen to clear all attached files event
            $("#owm_forum_new_topic_clear_files").bind("click", function(e)
            {
                owFileAttachments[attachmentUid].reset(attachmentUid);
 
                $attachDefaultTitle.show();
                $firstAttachName.text("").hide();
                filesList = [];
            });

            // listen to attach new files event
            $("#owm_forum_new_topic_attach_files").bind("click", function(e)
            {
                $("#owm_forum_topic_attachments .mlt_file_input").trigger("click");
            });

            //  listen to upload a new file or show the files list
            $("#owm_forum_new_topic_attach_file").bind("click", function(e)
            {
                e.preventDefault();

                // allow upload only a first file
                if ( !filesList.length )
                {
                    $("#owm_forum_topic_attachments .mlt_file_input").trigger("click");
                }
                else
                {
                    // show the manage files list window
                    OWM.FloatBox({
                        "title" : OWM.getLanguageText("forum", "post_attachment"),
                        "content": $("#owm_forum_topic_attachments")
                    });
                }
            });

            /**
             * Get attached files name
             *
             * @return string
             */
            function getAttachedFilesName()
            {
                var length = filesList.length;
 
                if ( length )
                {
                    if ( length > 1 )
                    {
                        return length + " " + OWM.getLanguageText("forum", "attached_files");
                    }
 
                    // get the first file info
                    var file = filesList[0];
                    return file.name + " (" + file.size + "KB)";
                }
            } 
        });
    {/script}
{/if}